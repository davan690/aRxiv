<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{R/simcross User Guide}
-->

# aRxiv tutorial

[arXiv](http://arxiv.org) is a repository of electronic preprints for
computer science, mathematics, physics, quantiative biology,
quantitative finance, and statistics. The
[aRxiv package](https://github.com/ropensci/aRxiv) provides an
[R](http://www.r-project.org) interface to the
[arXiv API](http://arxiv.org/help/api/index).

Note that the arXiv API _does not_ require an API key.

```{r change_aRxiv_delay_option, include=FALSE}
options(aRxiv_delay=0.5)
```

## Installation

The [aRxiv package](https://github.com/ropensci/aRxiv) is not
currently available on [CRAN](http://cran.r-project.org). To install the
package from [GitHub](http://github.com), use
`devtools::install_github()`, as follows:

```{r install_pkgs, eval=FALSE}
install.packages("devtools")
library(devtools)
install_github("ropensci/aRxiv")
```

## Basic use

Use `arxiv_search()` to search [arXiv](http://arxiv.org),
`arxiv_count()` to get a simple count of manuscripts matching a
query, and `arxiv_open()` to open the abstract pages for a set of
results from `arxiv_search()`.

We'll get to the details in a moment. For now, let's look at a few
examples.

Suppose we wanted to identify all arXiv manuscripts with &ldquo;`Peter
Hall`&rdquo; as an author. It is best to first get a count, so that we have
a sense of how many records the search will return. (Peter Hall is
&ldquo;[among the world's most prolific and highly cited authors in both probability and statistics](http://en.wikipedia.org/wiki/Peter_Gavin_Hall).&rdquo;)
We first use `library()` to load the aRxiv package and then
`arxiv_count()` to get the count.

```{r arxiv_count}
library(aRxiv)
arxiv_count('au:"Peter Hall"')
```

The `au:` part indicates to search the author field; we use double
quotes to search for a _phrase_.

To obtain the actual records matching the query, use `arxiv_search()`.

```{r arxiv_search}
rec <- arxiv_search('au:"Peter Hall"')
nrow(rec)
```

The default is to grab no more than 10 records; this limit can be
changed with the `limit` argument. But note that the arXiv API will
not let you download more than 50,000 or so records, and even in that
case it's best to do so in batches; more on this below.

The following will get us all `r arxiv_count('au:"Peter Hall"')`
records.

```{r arxiv_search_limit50}
rec <- arxiv_search('au:"Peter Hall"', limit=50)
nrow(rec)
```

`arxiv_search()` returns a data frame with each row being a single
manuscript. The columns are the different fields (e.g., `authors`, `title`,
`abstract`, etc.). Fields like `authors` that
contain multiple items will be a single character string with the
multiple items separated by a vertical bar (`|`).

We might be interested in a more restrictive search, such as for Peter
Hall's arXiv manuscripts that have `deconvolution` in the title. We
use `ti:` to search the title field, and combine the two with `AND`.

```{r arxiv_search_deconvolution}
deconv <- arxiv_search('au:"Peter Hall" AND ti:deconvolution')
nrow(deconv)
```

Let's display just the authors and title for the results.

```{r authors_title}
deconv[, c('title', 'authors')]
```

We can open the abstract pages for these `r nrow(deconv)` manuscripts
using `arxiv_open()`. It takes, as input, the output of
`arxiv_search()`.

```{r arxiv_open, eval=FALSE}
arxiv_open(deconv)
```


## Forming queries

The two basic arguments to `arxiv_count` and `arxiv_search` are 
`query`, a
character string representing the search, and `id_list`, a list of
[arXiv manuscript identifiers](http://arxiv.org/help/arxiv_identifier). 

- If only `query` is provided, manuscripts matching that query are
  returned.
- If only `id_list` is provided, manuscripts in the list are
  returned.
- If both are provided, manuscripts in `id_list` that match `query`
  will be returned.

`query` may be a single character string or a vector of character
strings. If it is a vector, the elements are pasted together with
`AND`.

`id_list` may be a vector of strings or a single
comma-separated character string.

### Search terms

Generally, one would focus on forming the `query` argument. The aRxiv
package includes a dataset `query_terms` that lists the terms (like
`au`) that you can use.

```{r query_terms}
query_terms
```

Use a colon (`:`) to separate the query term from the actual query.
Multiple queries can be combined with `AND`, `OR`, and `ANDNOT`. The
default is `OR`.

```{r illustrate_AND}
arxiv_count('au:Peter au:Hall')
arxiv_count('au:Peter OR au:Hall')
arxiv_count('au:Peter AND au:Hall')
arxiv_count('au:Hall ANDNOT au:Peter')
```

It appears that in the author field (and many other fields) you must
search full words, and that wild cards not allowed.

```{r illustrate_wildcard}
arxiv_count('au:P* AND au:Hall')
arxiv_count('au:P AND au:Hall')
arxiv_count('au:"P Hall"')
```

### Subject classifications

arXiv has a set of `r nrow(arxiv_cats)` subject classifications,
searchable with the prefix `cat:`. The aRxiv package contains a
dataset `arxiv_cats` containing the abbreviations and descriptions.
Here are the statistics categories.

```{r arxiv_cats}
arxiv_cats[grep('^stat', arxiv_cats$abbreviation),]
```

To search these categories, you need to include either the full term
or use the `*` wildcard.

```{r search_cats}
arxiv_count('cat:stat')
arxiv_count('cat:stat.AP')
arxiv_count('cat:stat*')
```

### Dates and ranges of dates

The terms `submittedDate` (date/time of first submission) and
`lastUpdatedDate` (date/time of last revision) are particularly
useful for limiting a search with _many_ results, so that you may
combine multiple searches together, each within some window of time,
to get the full results.

The date/time information is of the form `YYYYMMDDHHMMSS`, for
example `20071018122534` for `2007-10-18 12:25:34`. You can use `*`
for a wildcard for the times. For example, to get all manuscripts
with initial submission on 2007-10-18:

```{r wildcard_times}
arxiv_count('submittedDate:20071018*')
```

But you can't use the wildcard within the _dates_.

```{r wildcard_date}
arxiv_count('submittedDate:2007*')
```

To get a count of all manuscripts with original submission in 2007,
use a date range, like `[from_date TO to_date]`. (If you give a partial
date, it's treated as the earliest date/time that matches, and the
range appears to be up to but not including the second date/time.)

```{r daterange}
arxiv_count('submittedDate:[2007 TO 2008]')
```

## Search results



## Sorting results



## Technical details

### Metadata limitations

Author fields; for example, T. P. Speed vs Terry Speed vs Terence
P. Speed

### Limit time between search requests

The [arXiv API user manual](http://arxiv.org/help/api/user-manual) states:

> In cases where the API needs to be called multiple times in a row,
> we encourage you to play nice and incorporate a 3 second delay in
> your code. The detailed examples below illustrate how to do this in
> a variety of languages.

R option `"aRxiv_delay"`; how to set 

Don't do searches in parallel

### Limit number of items returned

use `arxiv_count` before `arxiv_search`; `limit` arg; using slices of time 

option `"aRxiv_toomany"`

### Requests in batches

`batchsize` arg to `arxiv_search`, but still have a larger limit


## License and bugs

- License:
  [MIT](https://github.com/ropensci/aRxiv/blob/master/LICENSE)
- Report bugs or suggestions improvements by [submitting an issue](https://github.com/ropensci/aRxiv/issues) to
  [our GitHub repository for aRxiv](https://github.com/ropensci/aRxiv).



<!-- the following to make it look nicer -->
<link href="http://kbroman.org/qtlcharts/assets/vignettes/vignette.css" rel="stylesheet"></link>
